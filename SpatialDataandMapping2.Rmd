---
title: "SpatialData_and_Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---
---
title: "SpatialData_and_Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{R - Install Packages}
packages<-c("sf", "raster", "rgdal", "rgeos", "sp", "tidyverse", "rmarkdown", "RColorBrewer")

package.check <- lapply(packages,FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)}})

# clean environment
rm(packages, package.check)
```

# Working off of Chloe's desktop GIS workspace
```{r - Set Working Directory}
# Make sure working directory is automatically set to your local github folder
getwd()

#S
setwd("/Users/swaybright/Desktop/SpatialDataandMapping2/")

```
Vector data consists of points, lines, and/or polygons with spatial coordinates
# Load Vector Data
```{r - Load Vector Data}
#### Bring in all data
# Read in dataset of leafy spurge presence points in Fremont Co, WY

SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
study_area <- readOGR(dsn = ".", layer = "StudyArea")
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
FremontCo <- readOGR(dsn = ".", layer = "FremontCo")
head(SpurgeFull)
head(study_area)
head(FremontMRoads)
head(FremontWater)
head(FremontCo)

table(is.na(SpurgeFull$Latitude))# must be FALSE here! No TRUES. 
table(is.na(SpurgeFull$Longitude))# must be FALSE here! No TRUES. 

# Plot dataset. May take a bit
plot(SpurgeFull)
# Not that informative, add some spatial context with Fremont Co border and a plot again

# First, check coordinate system and projection, otherwise these will not align
proj4string(SpurgeFull)
proj4string(study_area)
proj4string(FremontMRoads)
proj4string(FremontWater)
proj4string(FremontCo)
# need to make these uniform

# what is the projection that your data are in?  You'll need to figure this out and specify below
proj <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
SpurgeFull <- spTransform(SpurgeFull, CRS(proj))
study_area <- spTransform(study_area, CRS(proj))
FremontMRoads <- spTransform(FremontMRoads, CRS(proj))
FremontWater <- spTransform(FremontWater, CRS(proj))
FremontCo <- spTransform(FremontCo, CRS(proj))

# make sure all projections line up
proj4string(SpurgeFull)
proj4string(study_area)
proj4string(FremontMRoads)
proj4string(FremontWater)
proj4string(FremontCo)
# perfect!

# Plot datasets to make sure they line up. May take a bit
plot(SpurgeFull)
plot(FremontCo, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")

# great, now let's zoom in a bit to help with processing time

# First lets clip the data to only look at Lander/Riverton area
FremontMRoads <- FremontMRoads[study_area,]
SpurgeFull <- SpurgeFull[study_area,]
FremontWater <- FremontWater[study_area,]

# Check to make sure it worked
plot(SpurgeFull)
plot(study_area, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")
# why do the roads and rivers still extend outside the study area polygon?

# Lets to a little cleaner version of an intersection
FremontWater <- gIntersection(FremontWater, study_area)
FremontMRoads <- gIntersection(FremontMRoads, study_area)

plot(SpurgeFull)
plot(study_area, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")
# what has changed in the data? 
# hint:look at length of some features or total length in 

# take a different look in ggplot
# Have to fortify to plot with ggplot
study_areaF <- fortify(study_area)
SpurgeFullF <- fortify(SpurgeFull)
FremontWaterF <- fortify(FremontWater)
FremontCoF <- fortify(FremontCo)


# Plot spurge and fremont country to continue to get oriented
ggplot() +
  geom_polygon(data = FremontCoF, aes(x=long, y=lat), color = "red") +
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group),color ="green")+
  theme_minimal()+
  labs(x="",y="")

# Plot dataset with new clipped extent
ggplot() +
  geom_polygon(data = study_areaF, aes(x=long, y=lat), color = "darkred") +
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), fill = "blue", color = "blue" ) +    
    geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), fill = "orange", color = "orange" ) +    
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black" ) +
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())

```

Raster data is made up of a grid of pixels filled with values. These can be continuous variables like elevation, thematic values like landcover, or reflectance values like remote sensing imagery. 
# Load Raster Data
```{r Import Raster Data}
# For this project, we have three continuous topographic rasters and one thematic landcover raster
# Import elevation
Elevation <- raster("elev_output.tif")
plot(Elevation)

# Import GAP landcover data
GAPCover <- raster("GAP_output.tif")
plot(GAPCover)
# Alright, all data is in!

# What to we need to do to make sure things will line up?
proj4string(Elevation)
proj4string(GAPCover)
# all looks great!

```

# plot Raster Data w/ fremont maps
```{r}
# clip the rasters to start since they will plot MUCH slower than the lines or polygons.
Elevation <- crop(Elevation, study_area)
GAPCover <- crop(GAPCover, study_area)

#GAPCover
#We  need to convert GAP landcover data from a raster to points to use in ggplot!
map.p <- rasterToPoints(GAPCover)
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
df<-fortify(df)

#GAPCover map - you'll have to give this a minute or two to plot!
ggplot(df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="yellow")
#we need a legend... 

#or w/ all of Fremont Co!
GAPCover <- raster("GAP_output.tif")
masked<-mask(GAPCover,FremontCo)
GAPCover<-masked

map.p <- rasterToPoints(GAPCover)
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
df<-fortify(df)

#all un-cropped
SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
FremontCo <- readOGR(dsn = ".", layer = "FremontCo")

#fortify for ggplot
SpurgeFullF <- fortify(SpurgeFull)

#crop water to just Fremont Co
FremontWater<-crop(FremontWater,FremontCo)
FremontWaterF <- fortify(FremontWater)

#plot all together!
ggplot(df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="yellow")

# You can do this for Elevation too, if you're interested, but 1st mask it first to Fremont Co!
Elevation <- raster("elev_output.tif")
masked<-mask(Elevation,FremontCo)
Elevation<-masked

#raster to points for ggplot!
map.p <- rasterToPoints(Elevation)
elev.df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
elev.df<-fortify(df)

#Elevation map - you'll have to give this a minute or two to plot!
ggplot(elev.df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="chartreuse")

```
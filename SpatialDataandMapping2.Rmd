---
title: "SpatialData_and_Mapping"
output:
  word_document: default
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---
---
title: "SpatialData_and_Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{R - Install Packages, message=F}
packages<-c("sf", "raster", "rgdal", "rgeos", "sp", "tidyverse", "rmarkdown", "RColorBrewer","knitr")

package.check <- lapply(packages,FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)}})

# clean environment
rm(packages, package.check)
```

# Working off of Chloe's desktop GIS workspace
```{r - Set Working Directory,message=F}
# Make sure working directory is automatically set to your local github folder
getwd()

#S
setwd("/Users/swaybright/Desktop/SpatialDataandMapping2/")
```
Vector data consists of points, lines, and/or polygons with spatial coordinates
# Load Vector Data
```{r - Load Vector Data,message=F}
#### Bring in all data
# Read in data set of leafy spurge presence points in Fremont Co, WY
SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
study_area <- readOGR(dsn = ".", layer = "StudyArea")
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
FremontCo <- readOGR(dsn = ".", layer = "FremontCo")

#make sure data looks clean
table(is.na(SpurgeFull$Latitude))# must be FALSE here! No TRUES. 
table(is.na(SpurgeFull$Longitude))# must be FALSE here! No TRUES. 
```

```{r - Projections,message=F}

# First, check coordinate system and projection, otherwise these will not align
crs(SpurgeFull)
crs(study_area)
crs(FremontMRoads)
crs(FremontWater)
crs(FremontCo)
# need to make these uniform

# what is the projection that your data are in?  You'll need to figure this out and specify below
proj <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
SpurgeFull <- spTransform(SpurgeFull, CRS(proj))
study_area <- spTransform(study_area, CRS(proj))
FremontMRoads <- spTransform(FremontMRoads, CRS(proj))
FremontWater <- spTransform(FremontWater, CRS(proj))
FremontCo <- spTransform(FremontCo, CRS(proj))

# make sure all projections line up
crs(SpurgeFull)
crs(study_area)
crs(FremontMRoads)
crs(FremontWater)
crs(FremontCo)
# perfect!
```

It is best practice to plot the data as you go. In this case it takes a long time.
#Skip plotting data
```{r - Plot data - just kidding!,message=F}

# Plot data set
  # plot(SpurgeFull)
# Not that informative, add some spatial context with Fremont Co border and a plot again

#help
#knitr::include_graphics("plot1.jpg")

# Plot datasets to make sure they line up. May take a bit
  # plot(SpurgeFull)
  # plot(FremontCo, add = T, border = "red")
  # plot(FremontWater, add = T, border = "blue")
  # plot(FremontMRoads, add = T, border = "grey")

# great, now let's zoom in a bit to help with processing time
```

```{r - clip data to smaller extent and plot in ggplot,message=F}

# First lets clip the data to only look at Lander/Riverton area
SpurgeFull <- SpurgeFull[study_area,]
FremontWater <- crop(study_area,FremontWater)
FremontMRoads<-FremontMRoads[study_area,]

#clean - this still doesn't work for me
#FremontMRoads<-gIntersection(study_area,FremontMRoads)

# take a different look in ggplot
# Have to fortify to plot with ggplot
study_areaF <- fortify(study_area)
SpurgeFullF <- fortify(SpurgeFull)
FremontWaterF <- fortify(FremontWater)
FremontCoF <- fortify(FremontCo)
FremontMRoadsF<-fortify(FremontMRoads) 

# Plot data set with new clipped extent
ggplot()+
  geom_polygon(data=study_areaF, aes(x=long, y=lat), color="red", fill="grey")+
  geom_polygon(data=FremontWaterF, aes(x=long, y=lat, group=group), color="blue")+    
  geom_line(data=FremontMRoads, aes(x=long, y=lat, group=group), color="black")+ #still outside of bounds 
  geom_polygon(data=SpurgeFullF, aes(x=long, y=lat, group=group),color="chartreuse")+  
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid=element_blank(), axis.text=element_blank())

```

Raster data is made up of a grid of pixels filled with values. These can be continuous variables like elevation, thematic values like landcover, or reflectance values like remote sensing imagery. 
# Load Raster Data
```{r Import Raster Data,message=F}
# For this project, we have three continuous topographic rasters and one thematic landcover raster
# Import elevation
Elevation <- raster("elev_output.tif")
plot(Elevation)

# Import GAP landcover data
GAPCover <- raster("GAP_output.tif")
plot(GAPCover)
# Alright, all data is in!

# What to we need to do to make sure things will line up?
proj4string(Elevation)
proj4string(GAPCover)
# all looks great!

```

# plot Raster Data w/ fremont maps
```{r Plot all data into one lovely map,message=F}
# clip the rasters to start since they will plot MUCH slower than the lines or polygons.
Elevation <- crop(Elevation, study_area)
GAPCover <- crop(GAPCover, study_area)

#GAPCover
#We  need to convert GAP landcover data from a raster to points to use in ggplot!
map.p <- rasterToPoints(GAPCover)
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
df<-fortify(df)

#GAPCover map - you'll have to give this a minute or two to plot!
ggplot(df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="yellow")
#we need a legend... 

#or w/ all of Fremont Co!
GAPCover <- raster("GAP_output.tif")
masked<-mask(GAPCover,FremontCo)
GAPCover<-masked

map.p <- rasterToPoints(GAPCover)
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
df<-fortify(df)

#all un-cropped
SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
FremontCo <- readOGR(dsn = ".", layer = "FremontCo")

#fortify for ggplot
SpurgeFullF <- fortify(SpurgeFull)
FremontMRoadsF<-fortify(FremontMRoads)

#crop water to just Fremont Co
FremontWater<-crop(FremontWater,FremontCo)
FremontWaterF <- fortify(FremontWater)

#plot all together!
ggplot(df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="yellow")

# You can do this for Elevation too, if you're interested, but 1st mask it first to Fremont Co!
Elevation <- raster("elev_output.tif")
masked<-mask(Elevation,FremontCo)
Elevation<-masked

#raster to points for ggplot!
map.p <- rasterToPoints(Elevation)
elev.df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
elev.df<-fortify(df)

#Elevation map - you'll have to give this a minute or two to plot!
ggplot(elev.df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  labs(x="", y="")+
  scale_fill_gradientn(colours=brewer.pal(9, "RdPu"))+
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), color = "blue")+
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "black")+
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), color ="chartreuse")

```
---
title: "SpatialData_and_Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---
---
title: "SpatialData_and_Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{R - Install Packages}
<<<<<<< HEAD
packages<-c("sf", "raster", "rgdal", "rgeos", "sp", "tidyverse", "rmarkdown")

=======
#checking push/pull
# ditto, checking my push and pull
#does this work?
packages<-c("raster","rgdal","sp","rgeos","spatial","GISTools","maptools","spatstat","randomForest","sf","stats","tidyverse","magrittr","lintr","viridis","cowplot","rmarkdown")
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
package.check <- lapply(packages,FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)}})
<<<<<<< HEAD

=======
# All good
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
# clean environment
rm(packages)
```

# Working off of Chloe's desktop GIS workspace
```{r - Set Working Directory}
# Make sure working directory is automatically set to your local github folder
getwd()



# Chloe's desktop
setwd("C:/Users/Invasion Lab/Desktop/SpatialDataandMapping")
#Sarah's dektop
setwd("/Users/swaybright/Desktop/")
#Nathan's dektop
setwd("G:/Shared drives/wyo-coop-hough/Hough_Nathan/Hough_Nathan/Classes/DataWrangling/Scripts/SpatialDataandMapping/SpatialDataandMapping")
```
Vector data consists of points, lines, and/or polygons with spatial coordinates
# Load Vector Data
```{r - Load Vector Data}
<<<<<<< HEAD

#### Bring in all data
# Read in dataset of leafy spurge presence points in Fremont Co, WY

SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
study_area <- readOGR(dsn = ".", layer = "StudyArea")
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
head(SpurgeFull)
head(study_area)
head(FremontMRoads)
head(FremontWater)

table(is.na(SpurgeFull$Latitude))# must be FALSE here! No TRUES. 
table(is.na(SpurgeFull$Longitude))# must be FALSE here! No TRUES. 

=======
# Read in dataset of leafy spurge presence points in Fremont Co, WY
SpurgeFull <- readOGR(dsn = ".", layer = "SpurgeFull")
bbox(SpurgeFull)
# Plot dataset. May take a bit
plot(SpurgeFull)
# Not that informative, add some spatial context with Fremont Co border
FremontCo <- readOGR(dsn = ".", layer = "FremontCo")
StudyExtent <- readOGR(dsn = ".", layer = "FremontBuff1000m")
bbox(FremontCo)
bbox(StudyExtent)
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
# Check coordinate system and projection, otherwise these will not align
proj4string(SpurgeFull)
proj4string(study_area)
proj4string(FremontMRoads)
proj4string(FremontWater)

# what is the projection that your data are in?  You'll need to figure this out and specify below
proj <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
SpurgeFull <- spTransform(SpurgeFull, CRS(proj))
study_area <- spTransform(study_area, CRS(proj))
FremontMRoads <- spTransform(FremontMRoads, CRS(proj))
FremontWater <- spTransform(FremontWater, CRS(proj))

# make sure all projections line up
proj4string(SpurgeFull)
proj4string(study_area)
proj4string(FremontMRoads)
proj4string(FremontWater)

# Plot datasets to make sure they line up. May take a bit
plot(SpurgeFull)
<<<<<<< HEAD
plot(study_area, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")

# doesn't tell us a lot, let's try a more informative plot

# First lets clip the data to help with processing time
FremontMRoads <- FremontMRoads[study_area,]
SpurgeFull <- SpurgeFull[study_area,]
FremontWater <- FremontWater[study_area,]

# Check to make sure it worked
plot(SpurgeFull)
plot(study_area, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")
# why do the roads and rivers still extend outside the study area polygon?

FremontWater <- gIntersection(FremontWater, study_area)
FremontMRoads <- gIntersection(FremontMRoads, study_area)

plot(SpurgeFull)
plot(study_area, add = T, border = "red")
plot(FremontWater, add = T, border = "blue")
plot(FremontMRoads, add = T, border = "grey")
# what has changed in the data? 
# hint:look at length of some features or total length in 


# take a different look in ggplot
# Have to fortify to plot with ggplot
FremontMRoadsF <- fortify(FremontMRoads)
study_areaF <- fortify(study_area)
SpurgeFullF <- fortify(SpurgeFull)
FremontWaterF <- fortify(FremontWater)
# /////////////
  
=======
# Check the county layer
proj4string(FremontCo)
proj4string(StudyExtent)
# WGS84, no projection... Keep that for now
bbox(StudyExtent)
Bbox <- bbox
# Have to fortify to plot with ggplot
FremontCoF <- fortify(FremontCo)
StudyExtentF <- fortify(FremontCo)
SpurgeFullF <- fortify(SpurgeFull)
# Plot them together, finally
BaseMap <- ggplot() +
  geom_polygon(data = FremontCoF, aes(x=long, y=lat)) +
  geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), fill = "NA", color ="yellow")+
  theme_minimal()+
  labs(x="",y="")
BaseMap
# Import and adjust all other vector data
# Read in county roads
FremontCoRoad <- readOGR(dsn = ".", layer = "FremontCoRoad")
# Check projection
st_crs(FremontCoRoad)
proj4string(FremontCoRoad)
# Fortify
FremontCoRoadF <- fortify(FremontCoRoad)
# Plot dataset
ggplot() +
  geom_polygon(data = FremontCoF, aes(x=long, y=lat)) +
  geom_line(data = FremontCoRoadF, aes(x=long, y=lat, group = group), color = "white" )
# This  dataset is HUGE, cut it down to just the main roads
# Read in main roads
FremontMRoads <- readOGR(dsn = ".", layer = "FremontMainRoads")
# Check projection
st_crs(FremontMRoads)
proj4string(FremontMRoads)
# Fortify
FremontMRoadsF <- fortify(FremontMRoads)
# Plot dataset
ggplot() +
  geom_polygon(data = FremontCoF, aes(x=long, y=lat)) +
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "white")+
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())
# Read in waterways
FremontWater <- readOGR(dsn = ".", layer = "WaterwaysFremont")
# Check projection
proj4string(FremontWater)
# Fortify
FremontWaterF <- fortify(FremontWater)
bbox(FremontWater)
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
# Plot dataset
ggplot() +
  geom_polygon(data = study_areaF, aes(x=long, y=lat), fill = NA, color = "darkred") +
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), fill = "blue", color = "blue" ) +    
    geom_polygon(data = SpurgeFullF, aes(x=long, y=lat, group = group), fill = "orange", color = "yellow" ) +    
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), color = "white" ) +
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())
<<<<<<< HEAD
# Doesn't look a whole let better yet!
  


#### Maybe this other layer for class?
=======
#does this look right or do we need to mask this somehow??
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
# Read in public land management areas
FremontAgencies <- readOGR(dsn = ".", layer = "FremontAgencies")
# Check projection
proj4string(FremontAgencies)
# Fortify
FremontAgenciesF <- fortify(FremontAgencies)
# Plot dataset
ggplot() +
  geom_polygon(data = FremontCoF, aes(x=long, y=lat)) +
  geom_polygon(data = FremontAgenciesF, aes(x=long, y=lat, fill = id, group = group), color = "black") +
  geom_line(data = FremontMRoadsF, aes(x=long, y=lat, group = group), fill = "NA", color = "white" ) +
  geom_polygon(data = FremontWaterF, aes(x=long, y=lat, group = group), fill = "NA", color = "blue" )
plot(FremontAgencies)
<<<<<<< HEAD


```


=======
```
Raster data is made up of a grid of pixels filled with values. These can be continuous variables like elevation, thematic values like landcover, or reflectance values like remote sensing imagery. 
>>>>>>> efe4cdbed9b337f2ffb76902db5d9b866fb69a8d
# Load Raster Data
```{r Import Raster Data}
# For this project, we have three continuous topographic rasters and one thematic landcover raster
# Import elevation
Elevation <- raster("elev_output.tif")

st_crs(Elevation)
plot(Elevation)
# Import aspect
Aspect <- raster("aspect_output.tif")
st_crs(Aspect)
plot(Aspect)
# Import slope
Slope <- raster("slope_output.tif")
st_crs(Slope)
plot(Slope)
# Import GAP landcover data
GAPCover <- raster("GAP_output.tif")
st_crs(GAPCover)
plot(GAPCover)
# Alright, all data is in!
```

# plot Raster Data w/ fremont maps
```{r}
map.p <- rasterToPoints(Elevation)
#Make the points a dataframe for ggplot
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
#plot elevation
  ggplot(df, aes(x=Latitude, y=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  coord_equal()+
  scale_fill_gradient(high="yellow", low="darkgreen")
#aspect
map.p <- rasterToPoints(Aspect)
#Make the points a dataframe for ggplot
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
#plot aspect
  ggplot(df, aes(x=Latitude, y=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  #maybe?
  coord_equal()+
  scale_fill_gradient(high="yellow", low="darkgreen")
  #slope
  map.p <- rasterToPoints(Slope)
#Make the points a dataframe for ggplot
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
#plot slope
  ggplot(df, aes(x=Latitude, y=Longitude)) +
  geom_raster(aes(fill=MAP))+
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  #maybe?
  coord_equal()+
  scale_fill_gradient(high="yellow", low="darkgreen")
#GAP landcover data
map.p <- rasterToPoints(GAPCover)
df <- data.frame(map.p)
#Make appropriate column headings
colnames(df)<-c("Longitude", "Latitude", "MAP")
plot(GAPCover[[1]])
#plot slope
  ggplot(df, aes(y=Latitude, x=Longitude)) +
  geom_raster(aes(fill=MAP[[1]]))+
  theme_minimal()+
  labs(x="", y="")+
  theme(panel.grid = element_blank(), axis.text = element_blank())+
  scale_fill_gradient(high="yellow", low="darkgreen")